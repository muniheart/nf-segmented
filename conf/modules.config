env.APPTAINER_MESSAGELEVEL=5
env.SINGULARITY_MESSAGELEVEL=5

process {
    withName: SQUASH_WORK {
        publishDir = [
            [
                path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
                pattern: '*.sqfs',
                mode: 'symlink',
                overwrite: true,
            ]
        ]
    }

    withName: NFCORE_DEMO {
        containerOptions = {
            [
                container_opts,
                "--env NXF_CACHE_DIR=/nextflow",
                "-B ${cache_dir}:/nextflow",
            ].join(' ')
        }
    }
    withName: GET_INPUTS_FROM_DATA_FINAL {
        ext.is_final = true
    }
    withName: GET_INPUTS_FROM_DATA {
        ext.is_final = false
    }
    withName: MERGE_IMAGES {
        container = "https://depot.galaxyproject.org/singularity/nextflow%3A25.04.6--h2a3209d_0"

        containerOptions = { container_opts }

        publishDir = [
            [
                path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
                pattern: '*.sqfs',
                name: "${workflow.workDir}/*.sqfs",
                mode: 'symlink',
                overwrite: true,
            ]
        ]
    }
}
